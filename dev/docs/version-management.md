# Version Number Management in awesome-taskwarrior Ecosystem

## The Version Number Flow

```
Your Project Source
    ↓
make-awesome.py --install (detects version)
    ↓
Generates: project.meta (version=X.Y.Z)
Generates: project.install (VERSION="X.Y.Z")
    ↓
Copy to registry
    ↓
tw.py reads .meta files
    ↓
Shows in: tw --info, tw --list
```

## Where to Update Versions (In Order of Priority)

### 1. **Project Source** (Your Project Directory)
**Location:** Multiple places, ONE is authoritative

**Option A: VERSION file (Recommended - Simplest)**
```bash
# File: ~/dev/tw-need_priority-hook/VERSION
0.3.5
```

**Option B: version.txt**
```bash
# File: ~/dev/tw-need_priority-hook/version.txt
0.3.5
```

**Option C: In Python files**
```python
# File: on-add_need-priority.py
# Somewhere near the top:
version = "0.3.5"
# or
VERSION = "0.3.5"
```

**Option D: In bash files**
```bash
# File: some-script.sh
VERSION="0.3.5"
```

**Which one does make-awesome.py check?**
```python
# Detection order in make-awesome.py:
1. VERSION file
2. version.txt file
3. Python files (grep for: version = "...")
4. Bash files (grep for: VERSION="...")
```

**Best Practice:** Use a `VERSION` file in your project root. It's:
- Simple (one line, one place)
- Language-agnostic
- Easy to update programmatically
- Clear and obvious

### 2. **Generated .meta File**
**Location:** `~/dev/tw-need_priority-hook/need-priority.meta`

**Line 5:**
```ini
version=0.3.5
```

**How it gets there:**
- `make-awesome.py --install` detects from your project source
- Prompts you: `Version [0.3.5]:` 
- You can override by typing new version
- Gets written to .meta file

**Manual Update:** Edit line 5 directly if needed

### 3. **Generated .install File**
**Location:** `~/dev/tw-need_priority-hook/need-priority.install`

**Line 6:**
```bash
VERSION="0.3.5"
```

**How it gets there:**
- `make-awesome.py --install` uses same detected version
- Writes to .install header

**Manual Update:** Edit line 6 directly if needed

### 4. **Registry .meta File**
**Location:** `~/dev/awesome-taskwarrior/registry.d/need-priority.meta`

**This is a COPY of #2 above**

**How it gets there:**
- Stage 4 (--push) copies from project to registry
- `cp need-priority.meta ~/dev/awesome-taskwarrior/registry.d/`

**Manual Update:** Usually don't - let pipeline copy it

### 5. **Registry .install File**
**Location:** `~/dev/awesome-taskwarrior/installers/need-priority.install`

**This is a COPY of #3 above**

**How it gets there:**
- Stage 4 (--push) copies from project to registry
- `cp need-priority.install ~/dev/awesome-taskwarrior/installers/`

**Manual Update:** Usually don't - let pipeline copy it

---

## The Single Source of Truth Method (RECOMMENDED)

### Step 1: Create VERSION File in Your Project
```bash
cd ~/dev/tw-need_priority-hook
echo "0.4.0" > VERSION
git add VERSION
git commit -m "Bump to v0.4.0"
```

### Step 2: Run make-awesome.py
```bash
make-awesome.py --install

# It detects VERSION file:
# "Version [0.4.0]:"  ← Just press Enter
```

### Step 3: Pipeline Handles Rest
```bash
make-awesome.py "Release v0.4.0"

# Or separately:
make-awesome.py --install  # Generates .meta and .install with v0.4.0
make-awesome.py --push "Release v0.4.0"  # Copies to registry
```

**Result:** Version is consistent everywhere!

---

## The Manual Override Method

If you need to bump version without changing project source:

### During --install
```bash
make-awesome.py --install

# When prompted:
Version [0.3.5]: 0.4.0  ← Type new version
```

This updates:
- .meta file (line 5)
- .install file (line 6)

Then push copies them to registry.

**Caveat:** Your project source still says 0.3.5, but registry has 0.4.0

---

## The Quick Edit Method

If .meta and .install already exist and you just want to bump:

```bash
# Edit version in .meta
sed -i 's/^version=.*/version=0.4.0/' need-priority.meta

# Edit version in .install
sed -i 's/^VERSION=.*/VERSION="0.4.0"/' need-priority.install

# Also update header comment in .install
sed -i 's/# need-priority v.*/# need-priority v0.4.0 Installer/' need-priority.install

# Then push
make-awesome.py --push "Bump to v0.4.0"
```

**When to use:** Quick hotfix, emergency update

---

## Where Version Numbers Appear

### In Your Project:
1. `VERSION` file (or version.txt)
2. Python files docstrings: `version 0.3.5`
3. Python files variables: `VERSION = "0.3.5"`
4. README.md: `# need-priority v0.3.5`

### Generated by make-awesome.py:
5. `need-priority.meta` line 5: `version=0.3.5`
6. `need-priority.install` line 6: `VERSION="0.3.5"`
7. `need-priority.install` line 4: `# need-priority v0.3.5 Installer`

### In Registry:
8. `~/dev/awesome-taskwarrior/registry.d/need-priority.meta` (copy of #5)
9. `~/dev/awesome-taskwarrior/installers/need-priority.install` (copy of #6)

### Shown by tw.py:
10. `tw --info` reads from registry.d/need-priority.meta
11. `tw --list` reads from manifest (shows installed version)

---

## Programmatic Version Bump Workflow

### Automatic Bump Script (Bonus!)

Create `bump-version.sh` in your project:

```bash
#!/bin/bash
# bump-version.sh - Bump version everywhere

if [ $# -ne 1 ]; then
    echo "Usage: $0 <new-version>"
    echo "Example: $0 0.4.0"
    exit 1
fi

NEW_VERSION="$1"

# Update VERSION file
echo "$NEW_VERSION" > VERSION

# Update Python files
find . -name "*.py" -type f -exec sed -i "s/version = \"[0-9.]*\"/version = \"$NEW_VERSION\"/" {} \;
find . -name "*.py" -type f -exec sed -i "s/VERSION = \"[0-9.]*\"/VERSION = \"$NEW_VERSION\"/" {} \;

# Update README if exists
if [ -f README.md ]; then
    sed -i "s/v[0-9.]*/v$NEW_VERSION/g" README.md
fi

echo "✓ Bumped to v$NEW_VERSION"
echo ""
echo "Next steps:"
echo "  1. Review changes: git diff"
echo "  2. Commit: git add . && git commit -m 'Bump to v$NEW_VERSION'"
echo "  3. Deploy: make-awesome.py 'Release v$NEW_VERSION'"
```

**Usage:**
```bash
chmod +x bump-version.sh
./bump-version.sh 0.4.0
git diff  # Review
git add .
git commit -m "Bump to v0.4.0"
make-awesome.py "Release v0.4.0"
```

---

## Common Scenarios

### Scenario 1: Release New Version
```bash
# 1. Bump in source
echo "0.4.0" > VERSION

# 2. Full pipeline
make-awesome.py "Release v0.4.0"
# Detects 0.4.0, generates .meta and .install, pushes everything
```

### Scenario 2: Fix Metadata Only
```bash
# Already released v0.3.5, just fixing description/tags
make-awesome.py --install
# Version [0.3.5]:  ← Press Enter (keep same)
# Description: [update this]
# Tags: [update this]

make-awesome.py --push "Updated metadata"
```

### Scenario 3: Emergency Hotfix
```bash
# Need to bump registry version without full release
cd ~/dev/awesome-taskwarrior
vi registry.d/need-priority.meta  # Change version=0.3.6
git add registry.d/need-priority.meta
git commit -m "Hotfix: Bump need-priority to v0.3.6"
git push
```

### Scenario 4: Inconsistent Versions (Fix It)
```bash
# Project says 0.3.5, but registry has 0.4.0 - which is right?

# Option A: Registry is correct, update project
cd ~/dev/tw-need_priority-hook
echo "0.4.0" > VERSION
git add VERSION
git commit -m "Sync version with registry"

# Option B: Project is correct, update registry
make-awesome.py --install
# Version [0.3.5]:  ← Correct version
make-awesome.py --push "Sync registry with project"
```

---

## Version Consistency Check

**Check current versions everywhere:**
```bash
# In your project:
cat VERSION  # Or version.txt

# In generated files:
grep "^version=" need-priority.meta
grep "^VERSION=" need-priority.install

# In registry:
grep "^version=" ~/dev/awesome-taskwarrior/registry.d/need-priority.meta

# What tw shows:
tw --info | grep -A1 "need-priority"
```

**They should all match!**

---

## Best Practices

1. **Single Source:** Use `VERSION` file in project root
2. **Semantic Versioning:** Use X.Y.Z (major.minor.patch)
3. **Commit Before Deploy:** Always commit version bump before running pipeline
4. **Match Git Tags:** `git tag v0.4.0` to match VERSION file
5. **Update Changelog:** Document what changed in this version

---

## TL;DR - Quick Answer

**Q: Where do I update version for full programmatic effect?**

**A: In your project's VERSION file, then run the pipeline:**

```bash
cd ~/dev/tw-need_priority-hook
echo "0.4.0" > VERSION
git add VERSION
git commit -m "Bump to v0.4.0"
make-awesome.py "Release v0.4.0"
```

**One place, full effect!** ✅

---

## What make-awesome.py Does With Versions

```python
# Detection logic (simplified):
if Path("VERSION").exists():
    version = Path("VERSION").read_text().strip()
elif Path("version.txt").exists():
    version = Path("version.txt").read_text().strip()
else:
    # Look in .py files for: version = "X.Y.Z"
    # Look in .sh files for: VERSION="X.Y.Z"
    version = detected_from_code or "1.0.0"

# Then uses it:
print(f"Version [{version}]:")  # Prompt
meta_file.write(f"version={version}\n")  # .meta
install_file.write(f'VERSION="{version}"\n')  # .install
```

**Result:** One source, propagated everywhere!
