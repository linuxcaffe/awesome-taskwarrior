# make-awesome.py v4.4.0 - Installer Recursion Bug Fix
# Date: 2026-02-02

## Problem: The Installer Installing Itself! ü§¶

**Symptom:**
The generated `.install` file (e.g., recurrence-overhaul.install) was being:
1. Detected as a "script" by detect_files()
2. Added to the list of files to install
3. Installed to ~/.task/scripts/recurrence-overhaul.install
4. Creating a recursive situation where the installer installs itself!

**Root Cause:**
In detect_files() function, the script detection logic (lines 630-670) sweeps up ALL executable files with shebangs:

```python
if os.access(f, os.X_OK):
    with open(f, 'rb') as file:
        first_bytes = file.read(2)
        if first_bytes == b'#!':  # Has shebang
            files.append((f.name, 'script'))
```

The `.install` file meets these criteria:
- ‚úì Has chmod +x (executable)
- ‚úì Has shebang: #!/usr/bin/env bash
- ‚úì NOT in exclude_patterns list (was missing!)

Result: Installer recursively installs itself!

## Solution:

Added `.install` and `.meta` to exclude_patterns:

```python
exclude_patterns = [
    'debug.',           # debug.* files
    '.orig',            # backup files
    'on-add',           # hooks (handled above)
    'on-modify',        # hooks
    'on-exit',          # hooks
    'make-awesome.py',  # this script itself
    '.install',         # installer files (output, not input) ‚Üê NEW
    '.meta',            # metadata files (output, not input)  ‚Üê NEW
    '.git',             # git files
    '__pycache__',      # python cache
]
```

## Why This Makes Sense:

**.install files are OUTPUT, not INPUT:**
- They are GENERATED by make-awesome.py --install
- They should NOT be detected as source files
- They are the product, not the ingredients!

**.meta files are OUTPUT, not INPUT:**
- Also generated by make-awesome.py --install
- Metadata about the package, not package contents
- Should never be installed to user's system

## Impact:

**Before:** 
- recurrence-overhaul.install ‚Üí detected as script ‚Üí installed to ~/.task/scripts/
- Creates confusion: "Why is the installer in my scripts folder?"
- Wastes bandwidth downloading the installer again

**After:**
- recurrence-overhaul.install ‚Üí excluded from detection
- Only actual project files get installed
- Clean separation: installer vs installable content

## Testing:

To verify the fix works:

```bash
# In a project directory with .install and .meta files
./make-awesome.py --install

# Check output - should NOT include:
# "Script: recurrence-overhaul.install"
# "Script: recurrence-overhaul.meta"

# Only real scripts like 'rr' should be detected
```

## Related Files Fixed:
- /mnt/project/make-awesome.py (exclude_patterns updated)

## Status: FIXED ‚úì
